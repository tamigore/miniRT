/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   matrix_op.c                                        :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: tamigore <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2021/01/06 13:56:45 by tamigore          #+#    #+#             */
/*   Updated: 2021/01/06 18:11:13 by tamigore         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "libmath.h"

void		mat4Xmat4(t_m4 *a, t_m4 *b, t_m4 *mat)
{
	int		i;
	int		j;
	int		k;

	i = 0;
	while (i < 4)
	{
		j = 0;
		while (j < 4)
		{
			k = 0;
			while (k < 4)
			{
				mat->m[i][j] = a->m[i][k] * b->m[k][j] + mat->m[i][j];
				k++;
			}
			j++;
		}
		i++;
	}
}

t_v3		vec3Xmat4(t_v3 vec, double M[4][4])
{
	t_v3	res;

	res.x = M[0][0] * vec.x + M[0][1] * vec.y + M[0][2] * vec.z + M[0][3];
	res.y = M[1][0] * vec.x + M[1][1] * vec.y + M[1][2] * vec.z + M[1][3];
	res.z = M[2][0] * vec.x + M[2][1] * vec.y + M[2][2] * vec.z + M[2][3];
	return (res);
}

int			mat_invers(double m[4][4], t_m4 *invert)
{
	double	inv[4][4];
	double	det;
	int		i;
	int		j;

	inv[0][0] = m[1][1] * m[2][2] * m[3][3] - m[1][1] * m[2][3] * m[3][2] -
				m[2][1] * m[1][2] * m[3][3] + m[2][1] * m[1][3] * m[3][2] +
				m[3][1] * m[1][2] * m[2][3] - m[3][1] * m[1][3] * m[2][2];

	inv[1][0] = -m[1][0] * m[2][2] * m[3][3] + m[1][0] * m[2][3] * m[3][2] +
				m[2][0] * m[1][2] * m[3][3] - m[2][0] * m[1][3] * m[3][2] -
				m[3][0] * m[1][2] * m[2][3] + m[3][0] * m[1][3] * m[2][2];

	inv[2][0] = m[1][0] * m[2][1] * m[3][3] - m[1][0] * m[2][3] * m[3][1] -
				m[2][0] * m[1][1] * m[3][3] + m[2][0] * m[1][3] * m[3][1] +
				m[3][0] * m[1][1] * m[2][3] - m[3][0] * m[1][3] * m[2][1];

	inv[3][0] = -m[1][0] * m[2][1] * m[3][2] + m[1][0] * m[2][2] * m[3][1] +
				m[2][0] * m[1][1] * m[3][2] - m[2][0] * m[1][2] * m[3][1] -
				m[3][0] * m[1][1] * m[2][2] + m[3][0] * m[1][2] * m[2][1];

	inv[0][1] = -m[0][1] * m[2][2] * m[3][3] + m[0][1] * m[2][3] * m[3][2] +
				m[2][1] * m[0][2] * m[3][3] - m[2][1] * m[0][3] * m[3][2] -
				m[3][1] * m[0][2] * m[2][3] + m[3][1] * m[0][3] * m[2][2];

	inv[1][1] = m[0][0] * m[2][2] * m[3][3] - m[0][0] * m[2][3] * m[3][2] -
				m[2][0] * m[0][2] * m[3][3] + m[2][0] * m[0][3] * m[3][2] +
				m[3][0] * m[0][2] * m[2][3] - m[3][0] * m[0][3] * m[2][2];

	inv[2][1] = -m[0][0] * m[2][1] * m[3][3] + m[0][0] * m[2][3] * m[3][1] +
				m[2][0] * m[0][1] * m[3][3] - m[2][0] * m[0][3] * m[3][1] -
				m[3][0] * m[0][1] * m[2][3] + m[3][0] * m[0][3] * m[2][1];

	inv[3][1] = m[0][0] * m[2][1] * m[3][2] - m[0][0] * m[2][2] * m[3][1] -
				m[2][0] * m[0][1] * m[3][2] + m[2][0] * m[0][2] * m[3][1] +
				m[3][0] * m[0][1] * m[2][2] - m[3][0] * m[0][2] * m[2][1];

	inv[0][2] = m[0][1] * m[1][2] * m[3][3] - m[0][1] * m[1][3] * m[3][2] -
				m[1][1] * m[0][2] * m[3][3] + m[1][1] * m[0][3] * m[3][2] +
				m[3][1] * m[0][2] * m[1][3] - m[3][1] * m[0][3] * m[1][2];

	inv[1][2] = -m[0][0] * m[1][2] * m[3][3] + m[0][0] * m[1][3] * m[3][2] +
				m[1][0] * m[0][2] * m[3][3] - m[1][0] * m[0][3] * m[3][2] -
				m[3][0] * m[0][2] * m[1][3] + m[3][0] * m[0][3] * m[1][2];

	inv[2][2] = m[0][0] * m[1][1] * m[3][3] - m[0][0] * m[1][3] * m[3][1] -
				m[1][0] * m[0][1] * m[3][3] + m[1][0] * m[0][3] * m[3][1] +
				m[3][0] * m[0][1] * m[1][3] - m[3][0] * m[0][3] * m[1][1];

	inv[3][2] = -m[0][0] * m[1][1] * m[3][2] + m[0][0] * m[1][2] * m[3][1] +
				m[1][0] * m[0][1] * m[3][2] - m[1][0] * m[0][2] * m[3][1] -
				m[3][0] * m[0][1] * m[1][2] + m[3][0] * m[0][2] * m[1][1];

	 inv[0][3] = -m[0][1] * m[1][2] * m[2][3] + m[0][1] * m[1][3] * m[2][2] +
				m[1][1] * m[0][2] * m[2][3] - m[1][1] * m[0][3] * m[2][2] -
				m[2][1] * m[0][2] * m[1][3] + m[2][1] * m[0][3] * m[1][2];

	inv[1][3] = m[0][0] * m[1][2] * m[2][3] - m[0][0] * m[1][3] * m[2][2] -
				m[1][0] * m[0][2] * m[2][3] + m[1][0] * m[0][3] * m[2][2] + 
				m[2][0] * m[0][2] * m[1][3] - m[2][0] * m[0][3] * m[1][2];

	inv[2][3] = -m[0][0] * m[1][1] * m[2][3] + m[0][0] * m[1][3] * m[2][1] +
				m[1][0] * m[0][1] * m[2][3] - m[1][0] * m[0][3] * m[2][1] -
				m[2][0] * m[0][1] * m[1][3] + m[2][0] * m[0][3] * m[1][1];

	inv[3][3] = m[0][0] * m[1][1] * m[2][2] - m[0][0] * m[1][2] * m[2][1] -
				m[1][0] * m[0][1] * m[2][2] + m[1][0] * m[0][2] * m[2][1] +
				m[2][0] * m[0][1] * m[1][2] -  m[2][0] * m[0][2] * m[1][1];

	det = m[0][0] * inv[0][0] + m[0][1] * inv[1][0] + m[0][2] * inv[2][0] +
		m[0][3] * inv[3][0];
	if (det == 0)
		return (0);
	det = 1.0 / det;
	i = 0;
	while (i < 4)
	{
		j = 0;
		while (j < 4)
		{
			invert->m[i][j] = inv[i][j] * det;
			j++;
		}
		i++;
	}
	return (1);
}
